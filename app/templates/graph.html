{% extends "base.html" %}
{% block content %}
    {% if professor_list_list %}
        <div class="container">
        {% if professor_list_list|length%6!=0 %}
            {% set rownumber = (professor_list_list|length/6)|int+1 %}
        {% else %}
            {% set rownumber = (professor_list_list|length/6)|int %}
        {% endif %}
        {% for i in range(rownumber) %}
            <div class="row">
                {% if professor_list_list|length >= 6 %}
                    {% set colnumber = 6 %}
                {% else %}
                    {% set colnumber = professor_list_list|length %}
                {% endif %}
                {% for j in range(colnumber) %}
                    <div class="col">
                        <ul>
                            {% for eachprofessor in professor_list_list.pop(0) %}
                                <li><a href="/graph/professor/{{ eachprofessor }}">{{ eachprofessor }}</a></li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endfor %}
            </div>
        {% endfor %}
    {% elif cou_dict_list %}
        <div class="container">
            <table class="table table-sm table-hover">
                <thead class="thead-dark">
                <tr>
                    <th scope="col" id="sortlabel"
                        onclick='sortForSearchGraph(0,"Graph",{{ cou_dict_list|tojson }})'>class
                        section
                    </th>
                    <th scope="col" id="sortlabel"
                        onclick='sortForSearchGraph(1,"Graph",{{ cou_dict_list|tojson }})'>class
                        title
                    </th>
                </tr>
                </thead>
                {% for eachdict in cou_dict_list %}
                    <tr>
                        <td>
                            <a href="/graph/course/{{ eachdict.get("class_section") }}"> {{ eachdict.get("class_section") }}</a>
                        </td>
                        <td>{{ eachdict.get("class_title") }}</td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    {% elif speed_dict_list %}
        <div class="container">
            <table class="table table-sm table-hover">
                <thead class="thead-dark">
                <tr>
                    <th scope="col">class term</th>
                    <th scope="col">class title</th>
                    <th scope="col">class section</th>
                    <th scope="col">class number</th>
                    <th scope="col">class instructor</th>
                    <th scope="col">detail</th>
                </tr>
                </thead>
                {% for eachdict in speed_dict_list %}
                    <tr>
                        <td>{{ eachdict.get("class_term") }}</td>
                        <td>{{ eachdict.get("class_title") }}</td>
                        <td>{{ eachdict.get("class_section") }}</td>
                        <td>{{ eachdict.get("class_number") }}</td>
                        <td>
                            {% if eachdict.get('class_instructor')|length > 1 %}
                                {% for eachinstructor in eachdict['class_instructor'] %}
                                    {% if eachinstructor != '-Staff-' %}
                                        <a href={{ url_for('main.findrate', name=eachinstructor) }} target="_blank"
                                           name="ratemyprofessors">{{ eachinstructor }}</a>;
                                    {% else %}
                                        {{ eachinstructor }};
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                {% for eachinstructor in eachdict['class_instructor'] %}
                                    {% if eachinstructor != '-Staff-' %}
                                        <a href={{ url_for('main.findrate', name=eachinstructor) }} target="_blank"
                                           name="ratemyprofessors">{{ eachinstructor }}</a>
                                    {% else %}
                                        {{ eachinstructor }}
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        </td>
                        <td>
                            <a href="/graph/speed/{{ eachdict.get("class_term")+'_'+eachdict.get("class_number") }}">detail</a>
                        </td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    {% elif professor_name or course_name %}
        <div class="container">
            <div class="row">
                {% if professor_name %}
                    <h2><a href={{ url_for('main.findrate', name=professor_name) }} target="_blank"
                           name="ratemyprofessors">{{ professor_name }}</a></h2>
                    {% set datasource=professor_json %}
                {% elif course_name %}
                    <h2>
                        {% if course_section[-4] >= '5' %}
                            <a href="https://catalog.utdallas.edu/2019/graduate/courses/{{ course_section }}"
                               target="_blank">{{ course_name }}</a>
                        {% else %}
                            {{ course_name }}
                        {% endif %}
                    </h2>
                    {% set datasource=course_json %}
                {% endif %}
            </div>
            <div class="row">
                <div class="col-md-auto" id="graph" style="width:100%;height:800px;">
                </div>
            </div>
        </div>
        <script type="text/javascript">
            var myChart = echarts.init(document.getElementById('graph'));
            myChart.showLoading();
            datasource = {{ datasource|tojson }};
            myChart.hideLoading();

            // echarts.util.each(datasourse.children, function (datum, index) {
            //     index % 2 === 0 && (datum.collapsed = true);
            // });

            myChart.setOption(option = {
                tooltip: {
                    trigger: 'item',
                    triggerOn: 'mousemove'
                },
                series: [
                    {
                        type: 'tree',

                        data: [datasource],

                        top: '1%',
                        left: '9%',
                        bottom: '1%',
                        right: '30%',

                        symbolSize: 7,

                        label: {
                            normal: {
                                position: 'left',
                                verticalAlign: 'middle',
                                align: 'right',
                                fontSize: 12
                            }
                        },

                        leaves: {
                            label: {
                                normal: {
                                    position: 'right',
                                    verticalAlign: 'middle',
                                    align: 'left'
                                }
                            }
                        },

                        expandAndCollapse: true,
                        animationDuration: 550,
                        animationDurationUpdate: 750
                    }
                ]
            });
            myChart.on('click', function (params) {
                {% if professor_name %}
                    if (params.value)
                        window.open('/graph/course/CS ' + encodeURIComponent(params.value));
                {% elif course_name %}
                    if (params.value)
                        window.open('/graph/professor/' + encodeURIComponent(params.value));
                {% endif %}
            });
        </script>
    {% elif x_data and y_data %}
        <div class="container">
            <div class="row">
                <h2>{{ class_title }}</h2>
            </div>
            <div class="row">{{ class_term }} | {{ class_section }} | {{ (" ").join(class_instructor) }}</div>
            <div class="row">
                <div class="col-md-auto" id="graph" style="width:100%;height:800px;">
                </div>
            </div>
        </div>
        <script type="text/javascript">
            var myChart = echarts.init(document.getElementById('graph'));
            myChart.showLoading();
            myChart.hideLoading();

            option = {
                xAxis: {
                    type: 'category',
                    data: {{ x_data|tojson }}
                },
                yAxis: {
                    type: 'value'
                },
                dataZoom: [
                    {
                        type: 'slider',
                        start: 10,
                        end: 60
                    }
                ],
                series: [{
                    data: {{ y_data|tojson }},
                    type: 'line'
                }]
            };
            if (option && typeof option === "object") {
                myChart.setOption(option, true);
            }
        </script>
    {% endif %}
{% endblock %}